{
  "ID": "3df4838f-aa1e-42db-a78f-dc6f28f548eb",
  "Root": {
    "alive": true,
    "content": [
      "fa7675e6-b1db-4ecb-9095-44256c5f83a8",
      "84609542-4768-4bcc-a229-21bc199349e8",
      "4c82c231-9a8b-4e3e-a1ad-179da77fe377",
      "68353d90-bc2b-4526-94d6-7f931db68be4",
      "bf7fcecc-6d75-4da9-8e45-4da33b096d3d",
      "22993197-83d8-4c87-8a2a-8763fe1c8b0b",
      "82fb59dc-8cc4-402d-aec3-62f92242d0f4",
      "d4d0aa28-1832-4c0d-bf83-23c05fe99cbf",
      "a39346b2-25ec-4c08-9ef1-e50e0208b961",
      "bf655320-cc6f-4ed4-82b2-7b476f675b31",
      "6b2d496a-6569-4b29-81b7-e7c71d8400b3",
      "42d4ebd5-402a-4a51-a245-036c9dbd3b78",
      "717b47b8-0163-42d9-ad4f-257dc2df383b",
      "92c215c7-c7da-41e6-818b-6083695ec5ec",
      "80e24795-6fcf-4b04-91a8-57db73af5db3",
      "b9a81a6a-09d7-43a3-97df-32b901ff18c2",
      "2d4eb3a7-f75e-4203-ad97-cf7bc214921e",
      "2e073829-185d-48e9-8d9c-ad9e6ecdecd6",
      "5648a782-95f8-466e-9097-10f543c08850",
      "f58d8af0-ce74-4a27-b334-c6b64dee0201",
      "a09f58bb-fb48-4ece-8d04-484adc4f39e9",
      "45490259-9a35-4db9-ae21-c0c0a335f472"
    ],
    "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
    "created_time": 1550383831146,
    "format": {
      "page_full_width": true,
      "page_small_text": true
    },
    "id": "3df4838f-aa1e-42db-a78f-dc6f28f548eb",
    "ignore_block_count": true,
    "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
    "last_edited_time": 1550643120000,
    "parent_id": "52f7847c-61a0-4bd2-a311-9830661e289c",
    "parent_table": "block",
    "properties": {
      "title": [
        [
          "Un-pivot a dynamic set of columns based on condition"
        ]
      ]
    },
    "type": "page",
    "version": 8,
    "content_resolved": [
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1550383831141,
        "id": "fa7675e6-b1db-4ecb-9095-44256c5f83a8",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1550383831141,
        "parent_id": "3df4838f-aa1e-42db-a78f-dc6f28f548eb",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "The following example is a very useful basis when you are trying to convert transaction data to un-pivoted data for BI/reporting reasons, where the dimensions which are to be un-pivoted can have a dynamic set of columns."
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "The following example is a very useful basis when you are trying to convert transaction data to un-pivoted data for BI/reporting reasons, where the dimensions which are to be un-pivoted can have a dynamic set of columns."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1550383831144,
        "id": "84609542-4768-4bcc-a229-21bc199349e8",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1550383831144,
        "parent_id": "3df4838f-aa1e-42db-a78f-dc6f28f548eb",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "For our example, we suppose that the raw data table contains employee assessment data in the form of marked questions."
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "For our example, we suppose that the raw data table contains employee assessment data in the form of marked questions."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1550383831144,
        "id": "4c82c231-9a8b-4e3e-a1ad-179da77fe377",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1550383831144,
        "parent_id": "3df4838f-aa1e-42db-a78f-dc6f28f548eb",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "The raw data table is the following:"
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "The raw data table is the following:"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1550383831144,
        "id": "68353d90-bc2b-4526-94d6-7f931db68be4",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1550383831144,
        "parent_id": "3df4838f-aa1e-42db-a78f-dc6f28f548eb",
        "parent_table": "block",
        "properties": {
          "language": [
            [
              "Plain Text"
            ]
          ],
          "title": [
            [
              "create table rawdata\n\n(\n PersonId VARCHAR(255)\n,Question1Id INT(11)\n,Question2Id INT(11)\n,Question3Id INT(11)\n)"
            ]
          ]
        },
        "type": "code",
        "version": 1,
        "code": "create table rawdata\n\n(\n PersonId VARCHAR(255)\n,Question1Id INT(11)\n,Question2Id INT(11)\n,Question3Id INT(11)\n)",
        "code_language": "Plain Text"
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1550383831144,
        "id": "bf7fcecc-6d75-4da9-8e45-4da33b096d3d",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1550383831144,
        "parent_id": "3df4838f-aa1e-42db-a78f-dc6f28f548eb",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "The rawdata table is a temporary table as part of the ETL procedure and can have a varying number of questions. The goal is to use the same un-pivoting procedure for an arbitrary number of Questions, namely columns that are going to be un-pivoted."
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "The rawdata table is a temporary table as part of the ETL procedure and can have a varying number of questions. The goal is to use the same un-pivoting procedure for an arbitrary number of Questions, namely columns that are going to be un-pivoted."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1550383831144,
        "id": "22993197-83d8-4c87-8a2a-8763fe1c8b0b",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1550383831144,
        "parent_id": "3df4838f-aa1e-42db-a78f-dc6f28f548eb",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "Below is a toy example of rawdata table:"
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "Below is a toy example of rawdata table:"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1550383831145,
        "id": "82fb59dc-8cc4-402d-aec3-62f92242d0f4",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1550383831145,
        "parent_id": "3df4838f-aa1e-42db-a78f-dc6f28f548eb",
        "parent_table": "block",
        "properties": {
          "source": [
            [
              "http://i.stack.imgur.com/XC8KC.png"
            ]
          ]
        },
        "type": "image",
        "version": 1,
        "source": "http://i.stack.imgur.com/XC8KC.png",
        "image_url": "https://www.notion.so/image/https:%2F%2Fwww.notion.sohttp:%2F%2Fi.stack.imgur.com%2FXC8KC.png"
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1550383831145,
        "id": "d4d0aa28-1832-4c0d-bf83-23c05fe99cbf",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1550383831145,
        "parent_id": "3df4838f-aa1e-42db-a78f-dc6f28f548eb",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "The well-known,static way to unpivot the data, in MYSQL is by using UNION ALL:"
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "The well-known,static way to unpivot the data, in MYSQL is by using UNION ALL:"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1550383831145,
        "id": "a39346b2-25ec-4c08-9ef1-e50e0208b961",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1550383831145,
        "parent_id": "3df4838f-aa1e-42db-a78f-dc6f28f548eb",
        "parent_table": "block",
        "properties": {
          "language": [
            [
              "Plain Text"
            ]
          ],
          "title": [
            [
              "create table unpivoteddata\n\n(\n\n PersonId VARCHAR(255)\n,QuestionId VARCHAR(255)\n,QuestionValue INT(11)\n\n);\n\nINSERT INTO unpivoteddata SELECT PersonId, 'Question1Id' col, Question1Id \nFROM rawdata\nUNION ALL\nSELECT PersonId, 'Question2Id' col, Question2Id \nFROM rawdata\nUNION ALL\nSELECT PersonId, 'Question3Id' col, Question3Id \nFROM rawdata;"
            ]
          ]
        },
        "type": "code",
        "version": 1,
        "code": "create table unpivoteddata\n\n(\n\n PersonId VARCHAR(255)\n,QuestionId VARCHAR(255)\n,QuestionValue INT(11)\n\n);\n\nINSERT INTO unpivoteddata SELECT PersonId, 'Question1Id' col, Question1Id \nFROM rawdata\nUNION ALL\nSELECT PersonId, 'Question2Id' col, Question2Id \nFROM rawdata\nUNION ALL\nSELECT PersonId, 'Question3Id' col, Question3Id \nFROM rawdata;",
        "code_language": "Plain Text"
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1550383831145,
        "id": "bf655320-cc6f-4ed4-82b2-7b476f675b31",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1550383831145,
        "parent_id": "3df4838f-aa1e-42db-a78f-dc6f28f548eb",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "In our case we want to define a way to unpivot an arbitrary number of QuestionId columns. For that we need to execute a prepared statement that is a dynamic select of the desired columns. In order to be able to choose which columns need to be un-pivoted, we will use a GROUP_CONCAT statement and we will choose the columns for which the data type is set to ‘int’. In the GROUP_CONCAT we also include all additional elements of our SELECT statement to-be executed."
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "In our case we want to define a way to unpivot an arbitrary number of QuestionId columns. For that we need to execute a prepared statement that is a dynamic select of the desired columns. In order to be able to choose which columns need to be un-pivoted, we will use a GROUP_CONCAT statement and we will choose the columns for which the data type is set to ‘int’. In the GROUP_CONCAT we also include all additional elements of our SELECT statement to-be executed."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1550383831145,
        "id": "6b2d496a-6569-4b29-81b7-e7c71d8400b3",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1550383831145,
        "parent_id": "3df4838f-aa1e-42db-a78f-dc6f28f548eb",
        "parent_table": "block",
        "properties": {
          "language": [
            [
              "Plain Text"
            ]
          ],
          "title": [
            [
              "set @temp2 = null; \n\nSELECT GROUP_CONCAT(' SELECT ', 'PersonId',',','''',COLUMN_NAME,'''', ' col     ',',',COLUMN_NAME,' FROM rawdata' separator ' UNION ALL' ) FROM     INFORMATION_SCHEMA.COLUMNS WHERE table_name = 'rawdata' AND DATA_TYPE = 'Int' INTO     @temp2;\n\nselect @temp2;"
            ]
          ]
        },
        "type": "code",
        "version": 1,
        "code": "set @temp2 = null; \n\nSELECT GROUP_CONCAT(' SELECT ', 'PersonId',',','''',COLUMN_NAME,'''', ' col     ',',',COLUMN_NAME,' FROM rawdata' separator ' UNION ALL' ) FROM     INFORMATION_SCHEMA.COLUMNS WHERE table_name = 'rawdata' AND DATA_TYPE = 'Int' INTO     @temp2;\n\nselect @temp2;",
        "code_language": "Plain Text"
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1550383831145,
        "id": "42d4ebd5-402a-4a51-a245-036c9dbd3b78",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1550383831145,
        "parent_id": "3df4838f-aa1e-42db-a78f-dc6f28f548eb",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "In another occasion we could have chosen columns that the column name matches a pattern, for example instead of"
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "In another occasion we could have chosen columns that the column name matches a pattern, for example instead of"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1550383831145,
        "id": "717b47b8-0163-42d9-ad4f-257dc2df383b",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1550383831145,
        "parent_id": "3df4838f-aa1e-42db-a78f-dc6f28f548eb",
        "parent_table": "block",
        "properties": {
          "language": [
            [
              "Plain Text"
            ]
          ],
          "title": [
            [
              "DATA_TYPE = 'Int'"
            ]
          ]
        },
        "type": "code",
        "version": 1,
        "code": "DATA_TYPE = 'Int'",
        "code_language": "Plain Text"
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1550383831145,
        "id": "92c215c7-c7da-41e6-818b-6083695ec5ec",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1550383831145,
        "parent_id": "3df4838f-aa1e-42db-a78f-dc6f28f548eb",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "use"
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "use"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1550383831145,
        "id": "80e24795-6fcf-4b04-91a8-57db73af5db3",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1550383831145,
        "parent_id": "3df4838f-aa1e-42db-a78f-dc6f28f548eb",
        "parent_table": "block",
        "properties": {
          "language": [
            [
              "Plain Text"
            ]
          ],
          "title": [
            [
              "COLUMN_NAME LIKE 'Question%'"
            ]
          ]
        },
        "type": "code",
        "version": 1,
        "code": "COLUMN_NAME LIKE 'Question%'",
        "code_language": "Plain Text"
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1550383831146,
        "id": "b9a81a6a-09d7-43a3-97df-32b901ff18c2",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1550383831146,
        "parent_id": "3df4838f-aa1e-42db-a78f-dc6f28f548eb",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "or something suitable that can be controlled through the ETL phase."
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "or something suitable that can be controlled through the ETL phase."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1550383831146,
        "id": "2d4eb3a7-f75e-4203-ad97-cf7bc214921e",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1550383831146,
        "parent_id": "3df4838f-aa1e-42db-a78f-dc6f28f548eb",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "The prepared statement is finalized as follows:"
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "The prepared statement is finalized as follows:"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1550383831146,
        "id": "2e073829-185d-48e9-8d9c-ad9e6ecdecd6",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1550383831146,
        "parent_id": "3df4838f-aa1e-42db-a78f-dc6f28f548eb",
        "parent_table": "block",
        "properties": {
          "language": [
            [
              "Plain Text"
            ]
          ],
          "title": [
            [
              "set @temp3 = null;\n\nselect concat('INSERT INTO unpivoteddata',@temp2) INTO @temp3;\n\nselect @temp3;\n\nprepare stmt FROM @temp3;\nexecute stmt;\ndeallocate prepare stmt;"
            ]
          ]
        },
        "type": "code",
        "version": 1,
        "code": "set @temp3 = null;\n\nselect concat('INSERT INTO unpivoteddata',@temp2) INTO @temp3;\n\nselect @temp3;\n\nprepare stmt FROM @temp3;\nexecute stmt;\ndeallocate prepare stmt;",
        "code_language": "Plain Text"
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1550383831146,
        "id": "5648a782-95f8-466e-9097-10f543c08850",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1550383831146,
        "parent_id": "3df4838f-aa1e-42db-a78f-dc6f28f548eb",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "The unpivoteddata table is the following:"
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "The unpivoteddata table is the following:"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1550383831146,
        "id": "f58d8af0-ce74-4a27-b334-c6b64dee0201",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1550383831146,
        "parent_id": "3df4838f-aa1e-42db-a78f-dc6f28f548eb",
        "parent_table": "block",
        "properties": {
          "language": [
            [
              "Plain Text"
            ]
          ],
          "title": [
            [
              "SELECT * FROM unpivoteddata"
            ]
          ]
        },
        "type": "code",
        "version": 1,
        "code": "SELECT * FROM unpivoteddata",
        "code_language": "Plain Text"
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1550383831146,
        "id": "a09f58bb-fb48-4ece-8d04-484adc4f39e9",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1550383831146,
        "parent_id": "3df4838f-aa1e-42db-a78f-dc6f28f548eb",
        "parent_table": "block",
        "properties": {
          "source": [
            [
              "http://i.stack.imgur.com/2DZRJ.png"
            ]
          ]
        },
        "type": "image",
        "version": 1,
        "source": "http://i.stack.imgur.com/2DZRJ.png",
        "image_url": "https://www.notion.so/image/https:%2F%2Fwww.notion.sohttp:%2F%2Fi.stack.imgur.com%2F2DZRJ.png"
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1550383831146,
        "id": "45490259-9a35-4db9-ae21-c0c0a335f472",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1550383831146,
        "parent_id": "3df4838f-aa1e-42db-a78f-dc6f28f548eb",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "Selecting columns according to a condition and then crafting a prepared statement is an efficient way of dynamically un-pivoting data."
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "Selecting columns according to a condition and then crafting a prepared statement is an efficient way of dynamically un-pivoting data."
          }
        ]
      }
    ],
    "title": "Un-pivot a dynamic set of columns based on condition",
    "format_page": {
      "page_cover": "",
      "page_cover_position": 0,
      "page_font": "",
      "page_full_width": true,
      "page_icon": "",
      "page_small_text": true
    }
  },
  "Users": [
    {
      "email": "kkowalczyk@gmail.com",
      "family_name": "Kowalczyk",
      "given_name": "Krzysztof",
      "id": "bb760e2d-d679-4b64-b2a9-03005b21870a",
      "locale": "en",
      "mobile_onboarding_completed": true,
      "onboarding_completed": true,
      "profile_photo": "https://s3-us-west-2.amazonaws.com/public.notion-static.com/2dcaa66c-7674-4ff6-9924-601785b63561/head-bw-640x960.png",
      "time_zone": "America/Los_Angeles",
      "version": 18
    }
  ],
  "Tables": null
}