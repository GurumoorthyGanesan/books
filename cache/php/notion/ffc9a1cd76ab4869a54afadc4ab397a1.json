{
  "ID": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
  "Root": {
    "alive": true,
    "content": [
      "6548ad76-cc8b-4a09-908c-fc87c8815abe",
      "541b4fe5-15e1-4de5-8adc-5b3be6bcb04e",
      "5908ac0f-c96e-4f4d-a2eb-2184fdec1e28",
      "6f816c45-15ec-43dd-97fe-4de4ee10c733",
      "2451f0d8-15dd-47ab-900d-d0aa8fa7e360",
      "48806e92-210c-4440-846a-cf4e4dd9df2b",
      "64adea56-c23b-432f-8f99-5c73d55d594c",
      "a884001f-b4a9-4f20-bd7a-c5627a42a2b5",
      "3d48b110-41a5-4f6d-93b8-bca739645b8c",
      "563ec426-37a1-47a5-b7f7-b1547de31d71",
      "d0c75a96-a173-4ea7-946c-f26e3ce673ff",
      "f3518d11-6762-4c39-b311-b860739636c6",
      "9d841d87-5b75-4904-9d3f-0b4ddce829fe",
      "73fd546f-1cf0-4d36-8343-7802ad718731",
      "725336cd-de1c-4aaa-a9d9-76e37f63908c",
      "0a9b45f6-9f57-4f29-812a-d8865f1ca5e4",
      "1f73dac4-08ea-49dd-a775-6f2b2f67babc",
      "5fe3af32-11ff-4fa3-a851-5dbb27978f28",
      "0afef4ab-5d91-41ad-a460-7821440f418f",
      "d4441128-6e6c-4ec0-915b-bc63f6de3ade",
      "cff5c8b7-cf93-4c11-8db8-5d390c94008f",
      "e4b692c8-7743-4e56-a067-11858bfeac8e",
      "5ba992c6-7f64-4b1e-ab6e-f486c475c10f",
      "1b6d9ed0-83e9-44cb-94f3-679194ce1f81",
      "f5d050f2-0d69-4fbe-b914-0c3b34ddbe54",
      "68f03827-7399-47bd-8658-91b8c38143d8",
      "7cb02766-6e13-40ae-92d6-f71ca011e694",
      "81280052-b43a-4be2-acd7-fecbe14e1ff9",
      "28b3555a-6da5-404f-a27b-339565071a52",
      "66d5799f-76f4-4d31-9ebb-181af578de5d",
      "5a148d32-27d5-43ba-a184-4f2e47153bd8"
    ],
    "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
    "created_time": 1552023047195,
    "format": {
      "page_full_width": true,
      "page_small_text": true
    },
    "id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
    "ignore_block_count": true,
    "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
    "last_edited_time": 1552023047195,
    "parent_id": "0eabffb2-1a8c-43e6-b5d0-24c02329f9d1",
    "parent_table": "block",
    "properties": {
      "title": [
        [
          "Uploading files"
        ]
      ]
    },
    "type": "page",
    "version": 3,
    "content_resolved": [
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047185,
        "id": "6548ad76-cc8b-4a09-908c-fc87c8815abe",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047185,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "If you want users to upload files to your server you need to do a couple of security checks before you actually move the uploaded file to your web directory."
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "If you want users to upload files to your server you need to do a couple of security checks before you actually move the uploaded file to your web directory."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047185,
        "id": "541b4fe5-15e1-4de5-8adc-5b3be6bcb04e",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047185,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "The uploaded data:"
            ]
          ]
        },
        "type": "sub_header",
        "version": 1,
        "inline_content": [
          {
            "Text": "The uploaded data:"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047185,
        "id": "5908ac0f-c96e-4f4d-a2eb-2184fdec1e28",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047185,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "This array contains "
            ],
            [
              "user",
              [
                [
                  "b"
                ],
                [
                  "i"
                ]
              ]
            ],
            [
              " "
            ],
            [
              "submitted data",
              [
                [
                  "i"
                ]
              ]
            ],
            [
              " and is "
            ],
            [
              "not",
              [
                [
                  "i"
                ]
              ]
            ],
            [
              " information about the file itself. While usually this data is generated by the browser one can easily make a post request to the same form using software."
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "This array contains "
          },
          {
            "Text": "user",
            "AttrFlags": 5
          },
          {
            "Text": " "
          },
          {
            "Text": "submitted data",
            "AttrFlags": 4
          },
          {
            "Text": " and is "
          },
          {
            "Text": "not",
            "AttrFlags": 4
          },
          {
            "Text": " information about the file itself. While usually this data is generated by the browser one can easily make a post request to the same form using software."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047186,
        "id": "6f816c45-15ec-43dd-97fe-4de4ee10c733",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047186,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "language": [
            [
              "Plain Text"
            ]
          ],
          "title": [
            [
              "$_FILES['file']['name'];\n$_FILES['file']['type'];\n$_FILES['file']['size'];\n$_FILES['file']['tmp_name'];"
            ]
          ]
        },
        "type": "code",
        "version": 1,
        "code": "$_FILES['file']['name'];\n$_FILES['file']['type'];\n$_FILES['file']['size'];\n$_FILES['file']['tmp_name'];",
        "code_language": "Plain Text"
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047186,
        "id": "2451f0d8-15dd-47ab-900d-d0aa8fa7e360",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047186,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "name",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " - Verify every aspect of it."
            ]
          ]
        },
        "type": "bulleted_list",
        "version": 1,
        "inline_content": [
          {
            "Text": "name",
            "AttrFlags": 2
          },
          {
            "Text": " - Verify every aspect of it."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047187,
        "id": "48806e92-210c-4440-846a-cf4e4dd9df2b",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047187,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "type",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " - Never use this data. It can be fetched by using PHP functions instead."
            ]
          ]
        },
        "type": "bulleted_list",
        "version": 1,
        "inline_content": [
          {
            "Text": "type",
            "AttrFlags": 2
          },
          {
            "Text": " - Never use this data. It can be fetched by using PHP functions instead."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047187,
        "id": "64adea56-c23b-432f-8f99-5c73d55d594c",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047187,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "size",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " - Safe to use."
            ]
          ]
        },
        "type": "bulleted_list",
        "version": 1,
        "inline_content": [
          {
            "Text": "size",
            "AttrFlags": 2
          },
          {
            "Text": " - Safe to use."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047187,
        "id": "a884001f-b4a9-4f20-bd7a-c5627a42a2b5",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047187,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "tmp_name",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " - Safe to use."
            ]
          ]
        },
        "type": "bulleted_list",
        "version": 1,
        "inline_content": [
          {
            "Text": "tmp_name",
            "AttrFlags": 2
          },
          {
            "Text": " - Safe to use."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047188,
        "id": "3d48b110-41a5-4f6d-93b8-bca739645b8c",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047188,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "type": "divider",
        "version": 1
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047188,
        "id": "563ec426-37a1-47a5-b7f7-b1547de31d71",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047188,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "Exploiting the file name"
            ]
          ]
        },
        "type": "sub_header",
        "version": 1,
        "inline_content": [
          {
            "Text": "Exploiting the file name"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047188,
        "id": "d0c75a96-a173-4ea7-946c-f26e3ce673ff",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047188,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "Normally the operating system does not allow specific characters in a file name, but by spoofing the request you can add them allowing for unexpected things to happen. For example, lets name the file: "
            ],
            [
              "../script.php%00.png",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              "Take good look at that filename and you should notice a couple of things."
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "Normally the operating system does not allow specific characters in a file name, but by spoofing the request you can add them allowing for unexpected things to happen. For example, lets name the file: "
          },
          {
            "Text": "../script.php%00.png",
            "AttrFlags": 2
          },
          {
            "Text": "Take good look at that filename and you should notice a couple of things."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047188,
        "id": "f3518d11-6762-4c39-b311-b860739636c6",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047188,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "The first to notice is the "
            ],
            [
              "../",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              ", fully illegal in a file name and at the same time perfectly fine if you are moving a file from 1 directory to another, which we’re gonna do right?"
            ]
          ]
        },
        "type": "numbered_list",
        "version": 1,
        "inline_content": [
          {
            "Text": "The first to notice is the "
          },
          {
            "Text": "../",
            "AttrFlags": 2
          },
          {
            "Text": ", fully illegal in a file name and at the same time perfectly fine if you are moving a file from 1 directory to another, which we’re gonna do right?"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047189,
        "id": "9d841d87-5b75-4904-9d3f-0b4ddce829fe",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047189,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "Now you might think you were verifying the file extensions properly in your script but this exploit relies on the url decoding, translating "
            ],
            [
              "%00",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " to a "
            ],
            [
              "null",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " character, basically saying to the operating system, this string ends here, stripping off "
            ],
            [
              ".png",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " off the filename."
            ]
          ]
        },
        "type": "numbered_list",
        "version": 1,
        "inline_content": [
          {
            "Text": "Now you might think you were verifying the file extensions properly in your script but this exploit relies on the url decoding, translating "
          },
          {
            "Text": "%00",
            "AttrFlags": 2
          },
          {
            "Text": " to a "
          },
          {
            "Text": "null",
            "AttrFlags": 2
          },
          {
            "Text": " character, basically saying to the operating system, this string ends here, stripping off "
          },
          {
            "Text": ".png",
            "AttrFlags": 2
          },
          {
            "Text": " off the filename."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047189,
        "id": "73fd546f-1cf0-4d36-8343-7802ad718731",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047189,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "So now I’ve uploaded "
            ],
            [
              "script.php",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " to another directory, by-passing simple validations to file extensions. It also by-passes "
            ],
            [
              ".htaccess",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " files disallowing scripts to be executed from within your upload directory."
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "So now I’ve uploaded "
          },
          {
            "Text": "script.php",
            "AttrFlags": 2
          },
          {
            "Text": " to another directory, by-passing simple validations to file extensions. It also by-passes "
          },
          {
            "Text": ".htaccess",
            "AttrFlags": 2
          },
          {
            "Text": " files disallowing scripts to be executed from within your upload directory."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047189,
        "id": "725336cd-de1c-4aaa-a9d9-76e37f63908c",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047189,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "type": "divider",
        "version": 1
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047189,
        "id": "0a9b45f6-9f57-4f29-812a-d8865f1ca5e4",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047189,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "Getting the file name and extension safely"
            ]
          ]
        },
        "type": "sub_header",
        "version": 1,
        "inline_content": [
          {
            "Text": "Getting the file name and extension safely"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047191,
        "id": "1f73dac4-08ea-49dd-a775-6f2b2f67babc",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047191,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "You can use "
            ],
            [
              "pathinfo()",
              [
                [
                  "c"
                ],
                [
                  "a",
                  "http://php.net/manual/en/function.pathinfo.php"
                ]
              ]
            ],
            [
              " to extrapolate the name and extension in a safe manner but first we need to replace unwanted characters in the file name:"
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "You can use "
          },
          {
            "Text": "pathinfo()",
            "AttrFlags": 2,
            "Link": "http://php.net/manual/en/function.pathinfo.php"
          },
          {
            "Text": " to extrapolate the name and extension in a safe manner but first we need to replace unwanted characters in the file name:"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047191,
        "id": "5fe3af32-11ff-4fa3-a851-5dbb27978f28",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047191,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "language": [
            [
              "Plain Text"
            ]
          ],
          "title": [
            [
              "// This array contains a list of characters not allowed in a filename\n$illegal   = array_merge(array_map('chr', range(0,31)), [\"\u003c\", \"\u003e\", \":\", '\"', \"/\", \"\\\\\", \"|\", \"?\", \"*\", \" \"]);\n$filename  = str_replace($illegal, \"-\", $_FILES['file']['name']);\n\n$pathinfo  = pathinfo($filename);\n$extension = $pathinfo['extension'] ? $pathinfo['extension']:'';\n$filename  = $pathinfo['filename']  ? $pathinfo['filename']:'';\n\nif(!empty($extension) \u0026\u0026 !empty($filename)){\n  echo $filename, $extension;\n} else {\n  die('file is missing an extension or name');\n}"
            ]
          ]
        },
        "type": "code",
        "version": 1,
        "code": "// This array contains a list of characters not allowed in a filename\n$illegal   = array_merge(array_map('chr', range(0,31)), [\"\u003c\", \"\u003e\", \":\", '\"', \"/\", \"\\\\\", \"|\", \"?\", \"*\", \" \"]);\n$filename  = str_replace($illegal, \"-\", $_FILES['file']['name']);\n\n$pathinfo  = pathinfo($filename);\n$extension = $pathinfo['extension'] ? $pathinfo['extension']:'';\n$filename  = $pathinfo['filename']  ? $pathinfo['filename']:'';\n\nif(!empty($extension) \u0026\u0026 !empty($filename)){\n  echo $filename, $extension;\n} else {\n  die('file is missing an extension or name');\n}",
        "code_language": "Plain Text"
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047192,
        "id": "0afef4ab-5d91-41ad-a460-7821440f418f",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047192,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "While now we have a filename and extension that can be used for storing, I still prefer storing that information in a database and give that file a generated name of for example, "
            ],
            [
              "md5(uniqid().microtime())",
              [
                [
                  "c"
                ]
              ]
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "While now we have a filename and extension that can be used for storing, I still prefer storing that information in a database and give that file a generated name of for example, "
          },
          {
            "Text": "md5(uniqid().microtime())",
            "AttrFlags": 2
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047192,
        "id": "d4441128-6e6c-4ec0-915b-bc63f6de3ade",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047192,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "language": [
            [
              "Plain Text"
            ]
          ],
          "title": [
            [
              "+----+--------+-----------+------------+------+----------------------------------+---------------------+\n| id | title  | extension | mime       | size | filename                         | time                |\n+----+--------+-----------+------------+------+----------------------------------+---------------------+\n| 1  | myfile | txt       | text/plain | 1020 | 5bcdaeddbfbd2810fa1b6f3118804d66 | 2017-03-11 00:38:54 |\n+----+--------+-----------+------------+------+----------------------------------+---------------------+"
            ]
          ]
        },
        "type": "code",
        "version": 1,
        "code": "+----+--------+-----------+------------+------+----------------------------------+---------------------+\n| id | title  | extension | mime       | size | filename                         | time                |\n+----+--------+-----------+------------+------+----------------------------------+---------------------+\n| 1  | myfile | txt       | text/plain | 1020 | 5bcdaeddbfbd2810fa1b6f3118804d66 | 2017-03-11 00:38:54 |\n+----+--------+-----------+------------+------+----------------------------------+---------------------+",
        "code_language": "Plain Text"
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047192,
        "id": "cff5c8b7-cf93-4c11-8db8-5d390c94008f",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047192,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "This would resolve the issue of duplicate file names and unforseen exploits in the file name. It would also cause the attacker to guess where that file has been stored as he or she cannot specifically target it for execution."
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "This would resolve the issue of duplicate file names and unforseen exploits in the file name. It would also cause the attacker to guess where that file has been stored as he or she cannot specifically target it for execution."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047192,
        "id": "e4b692c8-7743-4e56-a067-11858bfeac8e",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047192,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "type": "divider",
        "version": 1
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047192,
        "id": "5ba992c6-7f64-4b1e-ab6e-f486c475c10f",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047192,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "Mime-type validation"
            ]
          ]
        },
        "type": "sub_header",
        "version": 1,
        "inline_content": [
          {
            "Text": "Mime-type validation"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047192,
        "id": "1b6d9ed0-83e9-44cb-94f3-679194ce1f81",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047192,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "Checking a file extension to determine what file it is is not enough as a file may named "
            ],
            [
              "image.png",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " but may very well contain a php script. By checking the mime-type of the uploaded file against a file extension you can verify if the file contains what its name is referring to."
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "Checking a file extension to determine what file it is is not enough as a file may named "
          },
          {
            "Text": "image.png",
            "AttrFlags": 2
          },
          {
            "Text": " but may very well contain a php script. By checking the mime-type of the uploaded file against a file extension you can verify if the file contains what its name is referring to."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047192,
        "id": "f5d050f2-0d69-4fbe-b914-0c3b34ddbe54",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047192,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "You can even go 1 step further for validating images, and that is actually opening them:"
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "You can even go 1 step further for validating images, and that is actually opening them:"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047193,
        "id": "68f03827-7399-47bd-8658-91b8c38143d8",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047193,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "language": [
            [
              "Plain Text"
            ]
          ],
          "title": [
            [
              "if($mime == 'image/jpeg' \u0026\u0026 $extension == 'jpeg' || $extension == 'jpg'){\n  if($img = imagecreatefromjpeg($filename)){\n    imagedestroy($img);\n  } else {\n    die('image failed to open, could be corrupt or the file contains something else.');\n  }\n}"
            ]
          ]
        },
        "type": "code",
        "version": 1,
        "code": "if($mime == 'image/jpeg' \u0026\u0026 $extension == 'jpeg' || $extension == 'jpg'){\n  if($img = imagecreatefromjpeg($filename)){\n    imagedestroy($img);\n  } else {\n    die('image failed to open, could be corrupt or the file contains something else.');\n  }\n}",
        "code_language": "Plain Text"
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047193,
        "id": "7cb02766-6e13-40ae-92d6-f71ca011e694",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047193,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "You can fetch the mime-type using a build-in "
            ],
            [
              "function",
              [
                [
                  "a",
                  "http://php.net/manual/en/function.mime-content-type.php"
                ]
              ]
            ],
            [
              " or a "
            ],
            [
              "class",
              [
                [
                  "a",
                  "http://php.net/manual/en/book.fileinfo.php"
                ]
              ]
            ],
            [
              "."
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "You can fetch the mime-type using a build-in "
          },
          {
            "Text": "function",
            "Link": "http://php.net/manual/en/function.mime-content-type.php"
          },
          {
            "Text": " or a "
          },
          {
            "Text": "class",
            "Link": "http://php.net/manual/en/book.fileinfo.php"
          },
          {
            "Text": "."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047194,
        "id": "81280052-b43a-4be2-acd7-fecbe14e1ff9",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047194,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "type": "divider",
        "version": 1
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047194,
        "id": "28b3555a-6da5-404f-a27b-339565071a52",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047194,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "White listing your uploads"
            ]
          ]
        },
        "type": "sub_header",
        "version": 1,
        "inline_content": [
          {
            "Text": "White listing your uploads"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047194,
        "id": "66d5799f-76f4-4d31-9ebb-181af578de5d",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047194,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "Most importantly, you should whitelist file extensions and mime types depending on each form."
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "Most importantly, you should whitelist file extensions and mime types depending on each form."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552023047195,
        "id": "5a148d32-27d5-43ba-a184-4f2e47153bd8",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552023047195,
        "parent_id": "ffc9a1cd-76ab-4869-a54a-fadc4ab397a1",
        "parent_table": "block",
        "properties": {
          "language": [
            [
              "Plain Text"
            ]
          ],
          "title": [
            [
              "function isFiletypeAllowed($extension, $mime, array $allowed)\n{\n    return  isset($allowed[$mime]) \u0026\u0026\n            is_array($allowed[$mime]) \u0026\u0026\n            in_array($extension, $allowed[$mime]);\n}\n\n$allowedFiletypes = [\n    'image/png'  =\u003e [ 'png' ],\n    'image/gif'  =\u003e [ 'gif' ],\n    'image/jpeg' =\u003e [ 'jpg', 'jpeg' ],\n];\n\nvar_dump(isFiletypeAllowed('jpg', 'image/jpeg', $allowedFiletypes));"
            ]
          ]
        },
        "type": "code",
        "version": 1,
        "code": "function isFiletypeAllowed($extension, $mime, array $allowed)\n{\n    return  isset($allowed[$mime]) \u0026\u0026\n            is_array($allowed[$mime]) \u0026\u0026\n            in_array($extension, $allowed[$mime]);\n}\n\n$allowedFiletypes = [\n    'image/png'  =\u003e [ 'png' ],\n    'image/gif'  =\u003e [ 'gif' ],\n    'image/jpeg' =\u003e [ 'jpg', 'jpeg' ],\n];\n\nvar_dump(isFiletypeAllowed('jpg', 'image/jpeg', $allowedFiletypes));",
        "code_language": "Plain Text"
      }
    ],
    "title": "Uploading files",
    "format_page": {
      "page_cover": "",
      "page_cover_position": 0,
      "page_font": "",
      "page_full_width": true,
      "page_icon": "",
      "page_small_text": true
    }
  },
  "Users": [
    {
      "email": "kkowalczyk@gmail.com",
      "family_name": "Kowalczyk",
      "given_name": "Krzysztof",
      "id": "bb760e2d-d679-4b64-b2a9-03005b21870a",
      "locale": "en",
      "mobile_onboarding_completed": true,
      "onboarding_completed": true,
      "profile_photo": "https://s3-us-west-2.amazonaws.com/public.notion-static.com/2dcaa66c-7674-4ff6-9924-601785b63561/head-bw-640x960.png",
      "time_zone": "America/Los_Angeles",
      "version": 18
    }
  ],
  "Tables": null
}