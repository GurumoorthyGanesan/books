{
  "ID": "7cb144af-20d7-4868-beb1-1d358e510ba3",
  "Root": {
    "alive": true,
    "content": [
      "22ba0d74-cbcd-49c1-bf45-fd5df5dee1d1",
      "69a02b50-6f88-4acb-a3c6-60946cdac540",
      "e453083b-b9ec-43a6-b639-3643bed94fc9",
      "4892effe-e6ae-4c5e-ae62-6f75739ba8a1",
      "f63fc82c-ae1c-44be-a622-487d01c1499b",
      "11894651-450d-49c5-adf8-5636b3247f66",
      "421c96b5-4d74-4690-9c59-a530865d84c3",
      "429632f9-445b-447a-9df7-3d3f2b9f7b6e",
      "4e78568b-43aa-4533-bb40-2eaa19ee5148",
      "c813a36a-fb2f-4014-88b2-96d601879035",
      "1efad8e7-ded7-484c-ba36-c8c7b999f4ae",
      "5164e515-4c53-4a0f-92cc-57b3dd859394"
    ],
    "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
    "created_time": 1552022664190,
    "format": {
      "page_full_width": true,
      "page_small_text": true
    },
    "id": "7cb144af-20d7-4868-beb1-1d358e510ba3",
    "ignore_block_count": true,
    "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
    "last_edited_time": 1552022664190,
    "parent_id": "a5af103b-d852-4d05-b5ed-007e9bc6dac6",
    "parent_table": "block",
    "properties": {
      "title": [
        [
          "Minimize memory usage when dealing with large files"
        ]
      ]
    },
    "type": "page",
    "version": 3,
    "content_resolved": [
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552022664188,
        "id": "22ba0d74-cbcd-49c1-bf45-fd5df5dee1d1",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552022664188,
        "parent_id": "7cb144af-20d7-4868-beb1-1d358e510ba3",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "If we need to parse a large file, e.g. a CSV more than 10 Mbytes containing millions of rows, some use "
            ],
            [
              "file",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " or "
            ],
            [
              "file_get_contents",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " functions and end up with hitting "
            ],
            [
              "memory_limit",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " setting with"
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "If we need to parse a large file, e.g. a CSV more than 10 Mbytes containing millions of rows, some use "
          },
          {
            "Text": "file",
            "AttrFlags": 2
          },
          {
            "Text": " or "
          },
          {
            "Text": "file_get_contents",
            "AttrFlags": 2
          },
          {
            "Text": " functions and end up with hitting "
          },
          {
            "Text": "memory_limit",
            "AttrFlags": 2
          },
          {
            "Text": " setting with"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552022664188,
        "id": "69a02b50-6f88-4acb-a3c6-60946cdac540",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552022664188,
        "parent_id": "7cb144af-20d7-4868-beb1-1d358e510ba3",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "Allowed memory size of XXXXX bytes exhausted"
            ]
          ]
        },
        "type": "quote",
        "version": 1,
        "inline_content": [
          {
            "Text": "Allowed memory size of XXXXX bytes exhausted"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552022664189,
        "id": "e453083b-b9ec-43a6-b639-3643bed94fc9",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552022664189,
        "parent_id": "7cb144af-20d7-4868-beb1-1d358e510ba3",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "error. Consider the following source (top-1m.csv has exactly 1 million rows and is about 22 Mbytes of size)"
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "error. Consider the following source (top-1m.csv has exactly 1 million rows and is about 22 Mbytes of size)"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552022664189,
        "id": "4892effe-e6ae-4c5e-ae62-6f75739ba8a1",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552022664189,
        "parent_id": "7cb144af-20d7-4868-beb1-1d358e510ba3",
        "parent_table": "block",
        "properties": {
          "language": [
            [
              "Plain Text"
            ]
          ],
          "title": [
            [
              "var_dump(memory_get_usage(true));\n$arr = file('top-1m.csv');\nvar_dump(memory_get_usage(true));"
            ]
          ]
        },
        "type": "code",
        "version": 1,
        "code": "var_dump(memory_get_usage(true));\n$arr = file('top-1m.csv');\nvar_dump(memory_get_usage(true));",
        "code_language": "Plain Text"
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552022664189,
        "id": "f63fc82c-ae1c-44be-a622-487d01c1499b",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552022664189,
        "parent_id": "7cb144af-20d7-4868-beb1-1d358e510ba3",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "This outputs:"
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "This outputs:"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552022664189,
        "id": "11894651-450d-49c5-adf8-5636b3247f66",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552022664189,
        "parent_id": "7cb144af-20d7-4868-beb1-1d358e510ba3",
        "parent_table": "block",
        "properties": {
          "language": [
            [
              "Plain Text"
            ]
          ],
          "title": [
            [
              "int(262144)\nint(210501632)"
            ]
          ]
        },
        "type": "code",
        "version": 1,
        "code": "int(262144)\nint(210501632)",
        "code_language": "Plain Text"
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552022664189,
        "id": "421c96b5-4d74-4690-9c59-a530865d84c3",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552022664189,
        "parent_id": "7cb144af-20d7-4868-beb1-1d358e510ba3",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "because the interpreter needed to hold all the rows in "
            ],
            [
              "$arr",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " array, so it consumed ~200 Mbytes of RAM. Note that we haven’t even done anything with the contents of the array."
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "because the interpreter needed to hold all the rows in "
          },
          {
            "Text": "$arr",
            "AttrFlags": 2
          },
          {
            "Text": " array, so it consumed ~200 Mbytes of RAM. Note that we haven’t even done anything with the contents of the array."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552022664189,
        "id": "429632f9-445b-447a-9df7-3d3f2b9f7b6e",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552022664189,
        "parent_id": "7cb144af-20d7-4868-beb1-1d358e510ba3",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "Now consider the following code:"
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "Now consider the following code:"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552022664189,
        "id": "4e78568b-43aa-4533-bb40-2eaa19ee5148",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552022664189,
        "parent_id": "7cb144af-20d7-4868-beb1-1d358e510ba3",
        "parent_table": "block",
        "properties": {
          "language": [
            [
              "Plain Text"
            ]
          ],
          "title": [
            [
              "var_dump(memory_get_usage(true));\n$index = 1;\nif (($handle = fopen(\"top-1m.csv\", \"r\")) !== FALSE) {\n    while (($row = fgetcsv($handle, 1000, \",\")) !== FALSE) {\n        file_put_contents('top-1m-reversed.csv',$index . ',' . strrev($row[1]) . PHP_EOL, FILE_APPEND);\n        $index++;\n    }\n    fclose($handle);\n}\nvar_dump(memory_get_usage(true));"
            ]
          ]
        },
        "type": "code",
        "version": 1,
        "code": "var_dump(memory_get_usage(true));\n$index = 1;\nif (($handle = fopen(\"top-1m.csv\", \"r\")) !== FALSE) {\n    while (($row = fgetcsv($handle, 1000, \",\")) !== FALSE) {\n        file_put_contents('top-1m-reversed.csv',$index . ',' . strrev($row[1]) . PHP_EOL, FILE_APPEND);\n        $index++;\n    }\n    fclose($handle);\n}\nvar_dump(memory_get_usage(true));",
        "code_language": "Plain Text"
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552022664189,
        "id": "c813a36a-fb2f-4014-88b2-96d601879035",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552022664189,
        "parent_id": "7cb144af-20d7-4868-beb1-1d358e510ba3",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "which outputs"
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "which outputs"
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552022664189,
        "id": "1efad8e7-ded7-484c-ba36-c8c7b999f4ae",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552022664189,
        "parent_id": "7cb144af-20d7-4868-beb1-1d358e510ba3",
        "parent_table": "block",
        "properties": {
          "language": [
            [
              "Plain Text"
            ]
          ],
          "title": [
            [
              "int(262144)\nint(262144)"
            ]
          ]
        },
        "type": "code",
        "version": 1,
        "code": "int(262144)\nint(262144)",
        "code_language": "Plain Text"
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552022664190,
        "id": "5164e515-4c53-4a0f-92cc-57b3dd859394",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552022664190,
        "parent_id": "7cb144af-20d7-4868-beb1-1d358e510ba3",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "so we don’t use a single extra byte of memory, but parse the whole CSV and save it to another file reversing the value of the 2nd column. That’s because "
            ],
            [
              "fgetcsv",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " reads only one row and "
            ],
            [
              "$row",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " is overwritten in every loop."
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "so we don’t use a single extra byte of memory, but parse the whole CSV and save it to another file reversing the value of the 2nd column. That’s because "
          },
          {
            "Text": "fgetcsv",
            "AttrFlags": 2
          },
          {
            "Text": " reads only one row and "
          },
          {
            "Text": "$row",
            "AttrFlags": 2
          },
          {
            "Text": " is overwritten in every loop."
          }
        ]
      }
    ],
    "title": "Minimize memory usage when dealing with large files",
    "format_page": {
      "page_cover": "",
      "page_cover_position": 0,
      "page_font": "",
      "page_full_width": true,
      "page_icon": "",
      "page_small_text": true
    }
  },
  "Users": [
    {
      "email": "kkowalczyk@gmail.com",
      "family_name": "Kowalczyk",
      "given_name": "Krzysztof",
      "id": "bb760e2d-d679-4b64-b2a9-03005b21870a",
      "locale": "en",
      "mobile_onboarding_completed": true,
      "onboarding_completed": true,
      "profile_photo": "https://s3-us-west-2.amazonaws.com/public.notion-static.com/2dcaa66c-7674-4ff6-9924-601785b63561/head-bw-640x960.png",
      "time_zone": "America/Los_Angeles",
      "version": 19
    }
  ],
  "Tables": null
}