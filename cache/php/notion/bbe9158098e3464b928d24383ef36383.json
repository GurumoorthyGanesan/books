{
  "ID": "bbe91580-98e3-464b-928d-24383ef36383",
  "Root": {
    "alive": true,
    "content": [
      "ce8a060e-a949-4681-9bfd-bdbcc1de03d7",
      "391c201d-e227-4409-9776-e33de9279417",
      "fd76b235-4209-450d-a436-0492ed0f8820",
      "7d144405-bcbf-4e31-bc52-96a6638beff1",
      "30418482-279c-4481-9a0f-9c9142a58216"
    ],
    "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
    "created_time": 1552024432389,
    "format": {
      "page_full_width": true,
      "page_small_text": true
    },
    "id": "bbe91580-98e3-464b-928d-24383ef36383",
    "ignore_block_count": true,
    "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
    "last_edited_time": 1552024432389,
    "parent_id": "057eb94f-bb82-4152-b310-dbb929c85b35",
    "parent_table": "block",
    "properties": {
      "title": [
        [
          "Proper use of HTTP X FORWARDED FOR"
        ]
      ]
    },
    "type": "page",
    "version": 3,
    "content_resolved": [
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552024432387,
        "id": "ce8a060e-a949-4681-9bfd-bdbcc1de03d7",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552024432387,
        "parent_id": "bbe91580-98e3-464b-928d-24383ef36383",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "In the light of the latest "
            ],
            [
              "httpoxy",
              [
                [
                  "a",
                  "https://httpoxy.org/"
                ]
              ]
            ],
            [
              " vulnerabilities, there is another variable, that is widely misused."
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "In the light of the latest "
          },
          {
            "Text": "httpoxy",
            "Link": "https://httpoxy.org/"
          },
          {
            "Text": " vulnerabilities, there is another variable, that is widely misused."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552024432388,
        "id": "391c201d-e227-4409-9776-e33de9279417",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552024432388,
        "parent_id": "bbe91580-98e3-464b-928d-24383ef36383",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "HTTP_X_FORWARDED_FOR",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " is often used to detect the client IP address, but without any additional checks, this can lead to security issues, especially when this IP is later used for authentication or in SQL queries without sanitization."
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "HTTP_X_FORWARDED_FOR",
            "AttrFlags": 2
          },
          {
            "Text": " is often used to detect the client IP address, but without any additional checks, this can lead to security issues, especially when this IP is later used for authentication or in SQL queries without sanitization."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552024432388,
        "id": "fd76b235-4209-450d-a436-0492ed0f8820",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552024432388,
        "parent_id": "bbe91580-98e3-464b-928d-24383ef36383",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "Most of the code samples available ignore the fact that "
            ],
            [
              "HTTP_X_FORWARDED_FOR",
              [
                [
                  "c"
                ]
              ]
            ],
            [
              " can actually be considered as information provided by the client itself and therefore "
            ],
            [
              "is not",
              [
                [
                  "b"
                ]
              ]
            ],
            [
              " a reliable source to detect clients IP address. Some of the samples do add a warning about the possible misuse, but still lack any additional check in the code itself."
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "Most of the code samples available ignore the fact that "
          },
          {
            "Text": "HTTP_X_FORWARDED_FOR",
            "AttrFlags": 2
          },
          {
            "Text": " can actually be considered as information provided by the client itself and therefore "
          },
          {
            "Text": "is not",
            "AttrFlags": 1
          },
          {
            "Text": " a reliable source to detect clients IP address. Some of the samples do add a warning about the possible misuse, but still lack any additional check in the code itself."
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552024432388,
        "id": "7d144405-bcbf-4e31-bc52-96a6638beff1",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552024432388,
        "parent_id": "bbe91580-98e3-464b-928d-24383ef36383",
        "parent_table": "block",
        "properties": {
          "title": [
            [
              "So here is an example of function written in PHP, how to detect a client IP address, if you know that client may be behind a proxy and you know this proxy can be trusted. If you don’t known any trusted proxies, you can just use "
            ],
            [
              "REMOTE_ADDR",
              [
                [
                  "c"
                ]
              ]
            ]
          ]
        },
        "type": "text",
        "version": 1,
        "inline_content": [
          {
            "Text": "So here is an example of function written in PHP, how to detect a client IP address, if you know that client may be behind a proxy and you know this proxy can be trusted. If you don’t known any trusted proxies, you can just use "
          },
          {
            "Text": "REMOTE_ADDR",
            "AttrFlags": 2
          }
        ]
      },
      {
        "alive": true,
        "created_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "created_time": 1552024432389,
        "id": "30418482-279c-4481-9a0f-9c9142a58216",
        "ignore_block_count": true,
        "last_edited_by": "bb760e2d-d679-4b64-b2a9-03005b21870a",
        "last_edited_time": 1552024432389,
        "parent_id": "bbe91580-98e3-464b-928d-24383ef36383",
        "parent_table": "block",
        "properties": {
          "language": [
            [
              "Plain Text"
            ]
          ],
          "title": [
            [
              "function get_client_ip()\n{\n    // Nothing to do without any reliable information\n    if (!isset($_SERVER['REMOTE_ADDR'])) {\n        return NULL;\n    }\n    \n    // Header that is used by the trusted proxy to refer to\n    // the original IP\n    $proxy_header = \"HTTP_X_FORWARDED_FOR\";\n\n    // List of all the proxies that are known to handle 'proxy_header'\n    // in known, safe manner\n    $trusted_proxies = array(\"2001:db8::1\", \"192.168.50.1\");\n\n    if (in_array($_SERVER['REMOTE_ADDR'], $trusted_proxies)) {\n        \n        // Get IP of the client behind trusted proxy\n        if (array_key_exists($proxy_header, $_SERVER)) {\n\n            // Header can contain multiple IP-s of proxies that are passed through.\n            // Only the IP added by the last proxy (last IP in the list) can be trusted.\n            $client_ip = trim(end(explode(\",\", $_SERVER[$proxy_header])));\n\n            // Validate just in case\n            if (filter_var($client_ip, FILTER_VALIDATE_IP)) {\n                return $client_ip;\n            } else {\n                // Validation failed - beat the guy who configured the proxy or\n                // the guy who created the trusted proxy list?\n                // TODO: some error handling to notify about the need of punishment\n            }\n        }\n    }\n\n    // In all other cases, REMOTE_ADDR is the ONLY IP we can trust.\n    return $_SERVER['REMOTE_ADDR'];\n}\n\nprint get_client_ip();"
            ]
          ]
        },
        "type": "code",
        "version": 1,
        "code": "function get_client_ip()\n{\n    // Nothing to do without any reliable information\n    if (!isset($_SERVER['REMOTE_ADDR'])) {\n        return NULL;\n    }\n    \n    // Header that is used by the trusted proxy to refer to\n    // the original IP\n    $proxy_header = \"HTTP_X_FORWARDED_FOR\";\n\n    // List of all the proxies that are known to handle 'proxy_header'\n    // in known, safe manner\n    $trusted_proxies = array(\"2001:db8::1\", \"192.168.50.1\");\n\n    if (in_array($_SERVER['REMOTE_ADDR'], $trusted_proxies)) {\n        \n        // Get IP of the client behind trusted proxy\n        if (array_key_exists($proxy_header, $_SERVER)) {\n\n            // Header can contain multiple IP-s of proxies that are passed through.\n            // Only the IP added by the last proxy (last IP in the list) can be trusted.\n            $client_ip = trim(end(explode(\",\", $_SERVER[$proxy_header])));\n\n            // Validate just in case\n            if (filter_var($client_ip, FILTER_VALIDATE_IP)) {\n                return $client_ip;\n            } else {\n                // Validation failed - beat the guy who configured the proxy or\n                // the guy who created the trusted proxy list?\n                // TODO: some error handling to notify about the need of punishment\n            }\n        }\n    }\n\n    // In all other cases, REMOTE_ADDR is the ONLY IP we can trust.\n    return $_SERVER['REMOTE_ADDR'];\n}\n\nprint get_client_ip();",
        "code_language": "Plain Text"
      }
    ],
    "title": "Proper use of HTTP X FORWARDED FOR",
    "format_page": {
      "page_cover": "",
      "page_cover_position": 0,
      "page_font": "",
      "page_full_width": true,
      "page_icon": "",
      "page_small_text": true
    }
  },
  "Users": [
    {
      "email": "kkowalczyk@gmail.com",
      "family_name": "Kowalczyk",
      "given_name": "Krzysztof",
      "id": "bb760e2d-d679-4b64-b2a9-03005b21870a",
      "locale": "en",
      "mobile_onboarding_completed": true,
      "onboarding_completed": true,
      "profile_photo": "https://s3-us-west-2.amazonaws.com/public.notion-static.com/2dcaa66c-7674-4ff6-9924-601785b63561/head-bw-640x960.png",
      "time_zone": "America/Los_Angeles",
      "version": 18
    }
  ],
  "Tables": null
}